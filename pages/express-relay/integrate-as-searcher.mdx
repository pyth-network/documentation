import { Callout, Tabs, Steps } from 'nextra/components'

# How to Integrate Express Relay as a Searcher

Express Relay gives one place stop for on-chain opportunities. Searchers can access opportunities from various DeFi protocols via a simple and unified interface. 

Searchers **bid** on opportunities exposed by the Express Relay server.
The server exposes different endpoints for interaction, which can be used directly via HTTP, WebSocket, or one of the SDKS for convenience.


Searchers can integrate with the Express Relay server in two steps:
- Integrate with the auction server
- Integrate with the opportunity adapter _(OPTIONAL)_




## Integrate with the auction server

Defi protocols integrated with Express Relay expose liquidation opportunities via the auction server. 
Searchers can access these opportunities by querying the server directly or subscribing to WebSocket updates.

To integrate with the auction server, follow these steps:
1. Fetch opportunities from the auction server.
1. Submit bids on opportunities to the auction server.

<Steps>

### Fetch opportunities from the auction server

Searchers can request via HTTP or subscribe to WebSocket updates to fetch opportunities from the auction server.

<Tabs items={['HTTP', 'Websocket']}>

<Tabs.Tab>
Searchers can request opportunities through an HTTP GET call to the `/v1/opportunities` endpoint. 

```bash copy
curl -X 'GET' \
  'https://per-staging.dourolabs.app/v1/opportunities?chain_id=op_sepolia&mode=live&permission_key=0xdeadbeef&from_time=2024-05-23T21%3A26%3A57.329954Z'
```
</Tabs.Tab>
<Tabs.Tab>
Searchers can connect to the server via WebSocket to reduce latency and subscribe to various events. The WebSocket endpoint relies at `/v1/ws`(e.g `wss://pyth-express-relay-mainnet.asymmetric.re/v1/ws`)

```bash copy
{
    "id": "1",
    "method": "subscribe",
    "params": {
        "chain_ids": ["op_sepolia"]
    }
}
```
</Tabs.Tab>
</Tabs>

The server responds with opportunities in the following format:

```json copy
{
  "target_calldata": "0xdeadbeef",                                      // Calldata to perform liquidation
  "chain_id": "op_sepolia",                                             
  "target_contract": "0xcA11bde05977b3631167028862bE2a173976CA11",      // Protocol contract address to call for liquidation
  "permission_key": "0xcafebabe",                                       // Unique identifier for the liquidation opportunity
  "target_call_value": "1",                                             // Value(in Wei) to send with to the Protocol contract.
  "buy_tokens": [                                                       // Tokens to buy (Collateral)
    {
      "amount": "1000",
      "token": "0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2"
    }
  ],
  "sell_tokens": [                                                      // Tokens to sell (Oustadaing Debt)
    {
      "amount": "900",
      "token": "0x2260fac5e5542a773aa44fbcfedf7c193bc2c599"
    }
  ],
  "version": "v1"                                                       // Opportunity format version
}
```



### Submit bids on opportunities to the auction server.

Searchers can submit bids on opportunities to the auction server via an HTTP POST or through a WebSocket connection.

<Tabs items={['HTTP', 'Websocket']}>

<Tabs.Tab>
Searchers can submit bids through an HTTP POST call to the `/v1/bids` endpoint. This endpoint accepts a JSON payload containing the details of the bid.

```bash copy
{
    "chain_id": "op_sepolia",
    "permission_key": "0x00000000000000000000000087ee27c5ae396b28a825968b277fece0720f5907000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000",
    "target_contract": "0x87ee27c5ae396b28a825968b277fece0720f5907"
    "target_calldata": "0xeadb38050000000000000000000000000000000000000000000000000000000000000064",
    "amount": "10",
}
```
</Tabs.Tab>
<Tabs.Tab>

Searchers can submit bids via Websocket to avoid additional network round-trips and get notified about changes to the bid status.

```bash copy
{
  "id": "1",
  "method": "post_bid",
  "params": {
    "bid": {
      "amount": "10",
      "calldata": "0xdeadbeef",
      "chain_id": "sepolia",
      "contract": "0xcA11bde05977b3631167028862bE2a173976CA11",
      "permission_key": "0xdeadbeefcafe"
    }
  }
}
```

A successful response to a bid submission has the following schema:

```bash copy
{
  "id": "1",                                            // websocket request id
  "status": "success",
  "result": {
    "id": "beedbeed-b346-4fa1-8fab-2541a9e1872d",       //bid id
    "status": "OK"
  }
}
```
</Tabs.Tab>
</Tabs>
</Steps>