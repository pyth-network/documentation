import Input from "../../components/Input";
import Arg from "../../components/Arg";
import Example from "../../components/Example";
import Examples from "../../components/Examples";
import DynamicCode from "../../components/DynamicCode";
import { InputFormats } from "../../utils/InputFormat";
import CosmWasmExecute from "../../components/CosmwasmExecute";
import { Tab, Tabs } from "nextra-theme-docs";

# Update Price Feeds

Update the on-chain price feeds using the provided `data`, which contains serialized and signed price update data from Pyth Network.
You can retrieve the latest price `data` for a given set of price feeds from the price service API.
Executing this message updates the on-chain price if the provided update is more recent than the current on-chain price.
Otherwise, the provided update will be ignored.
Execution will succeed even if the update is ignored.

This operation requires the caller to pay a fee to perform the update.
The required fee for a given set of updates can be computed using the [GetUpdateFee](query-get-update-fee) query.

Reverts if the required fee is not paid, or the `data` is incorrectly signed or formatted.

<div className="mt-6 overflow-x-auto">

| Argument                                           | Input                                           | Description                                       |
| -------------------------------------------------- | ----------------------------------------------- | ------------------------------------------------- |
| <Arg required={true} type="vec<Binary>">data</Arg> | <Input id="data" format={InputFormats.Base64}/> | The price update data for the contract to verify. |

</div>

<Examples>
  <Example
    keyValues={{
      data: async (ctx) =>
        (await ctx.getLatestPriceFeed("Crypto.BTC/USD", "default")).vaa,
    }}
    value="Latest BTC/USD update data"
  />
</Examples>

<CosmWasmExecute
  buildQuery={(kvs) => ({ get_update_fee: { data: [kvs["data"]] } })}
/>

## Example Code

<Tabs items={['Rust', 'Typescript', 'Query JSON']}>
    <Tab>
        <DynamicCode targets={{
            '"0x00"': (ctx) => `"${ctx.cosmosChainConfig.pythAddress}"`,
            '"0x11"': (ctx) => `"${ctx.get("data", "<vaa>")}"`,
        }}>
            ```rust copy
            use pyth_sdk_cw::{
              get_update_fee,
            };
            use cosmwasm_std::{
              Addr,
              Binary,
              Coin,
              Deps,
            };

            fn example_function(deps: &Deps) -> () {
              let fee_coin: Coin = get_update_fee(
                &deps.querier,
                Addr::unchecked("0x00"),
                &vec![Binary::from_base64("0x11").unwrap()]
              ).unwrap();
            }
            ```
        </DynamicCode>
    </Tab>

    <Tab>
        <DynamicCode targets={{
            "'0x0000'": (ctx) => `'${ctx.cosmosChainConfig.pythAddress}'`,
            "'0x1111'": (ctx) => `'${ctx.get("data", "<vaa>")}'`,
            "// NETWORK_NAME": (ctx) => `// ${ctx.currentCosmosChain}`,
            "'RPC_URL'": (ctx) => ctx.cosmosChainConfig?.rpcUrl !== undefined ? `'${ctx.cosmosChainConfig.rpcUrl}'` : 'RPC_URL',
        }}>
            ```typescript copy
            import { CosmWasmClient } from "@cosmjs/cosmwasm-stargate";

            // NETWORK_NAME
            const client = await CosmWasmClient.connect('RPC_URL');
            const contractAddress = '0x0000';

            let result = await client.queryContractSmart(
              contractAddress,
              {
                "get_update_fee": {
                  "data": ['0x1111']
                }
              }
            );
            ```
        </DynamicCode>
    </Tab>

    <Tab>
        <DynamicCode targets={{
            '"0x1111"': (ctx) => `"${ctx.get("data", "<vaa>")}"`,
        }}>
            ```json copy
            {
              "get_update_fee": {
                "data": ["0x1111"]
              }
            }
            ```
        </DynamicCode>
    </Tab>

</Tabs>
