# Pyth on NEAR

Pyth price feeds on NEAR are managed through the main NEAR Pyth smart
contract, enabling seamless interaction with on-chain data. In NEAR,
these interactions are facilitated by specific functions within the
Pyth receiver contract. This contract acts as an interface to Pyth
price feeds, handling the retrieval and updating of price data.

The two Key functions in the Pyth receiver contract to get started
are as follows:

- `update_price_feeds`: Updates multiple price feeds if they are fresh.
- `get_price`: Retrieves the current price from a specific price feed.

These functions are core for interacting with Pyth price feeds in
NEAR-based applications, providing a reliable and up-to-date source of
price information. For a full overview of methods provided by the NEAR
contract, see [the interface][] exposed by the receiver contract.

[the interface]: https://github.com/pyth-network/pyth-crosschain/blob/main/target_chains/near/receiver/src/ext.rs

## How to Update and Consume Price Feeds

1. Install NEAR JavaScript SDK: First, add the NEAR JavaScript SDK to
   your project. You can do this using npm or yarn:
   ```
   npm install near-api-js
   ```
   or
   ```
   yarn add near-api-js
   ```
2. Interact with the NEAR contract. This can be done with the Contract
   interface. Updating a price feed can be achieved like so:

   ```js
   const nearAPI = require("near-api-js");
   const { connect, keyStores, utils } = nearAPI;
   async function updatePriceFeeds() {
     const config = {
       networkId: "testnet",
       keyStore: new keyStores.InMemoryKeyStore(),
       nodeUrl: "https://rpc.testnet.near.org",
     };

     const near = await connect(config);
     const contractId = "pyth.testnet";
     const data = "YourDataString";
     const result = await account.functionCall({
       contractId,
       methodName: "update_price_feeds",
       args: { data },
       gas: new utils.BN("30000000000000"),
       attachedDeposit: utils.format.parseNearAmount("1"),
     });
     console.log("Update Price Feeds Result: ", result);
   }

   updatePriceFeeds();
   ```

   Note: gas and attachedDeposit are NEAR-specific parameters that you
   may need to set depending on the contract's requirements. Unused
   deposit will be refunded, but can be calculated by calling the
   `get_update_fee_estimate` method.

   Fetching a price feed is similar:

   ```js
   async function fetchPriceFeed() {
     const config = {
       networkId: "testnet",
       keyStore: new keyStores.InMemoryKeyStore(),
       nodeUrl: "https://rpc.testnet.near.org",
     };
     const near = await connect(config);
     const account = await near.account("user-account.testnet");
     const contractId = "pyth.testnet";
     const identifier = "PriceIdentifier";

     const priceFeed = await account.viewFunction(contractId, "get_price", {
       identifier,
     });
     console.log("Price Feed Data: ", priceFeed);
   }

   fetchPriceFeed();
   ```

## On-Chain Prices

For on-chain price interactions, see the [example contract][] in the
Pyth Github repo for an example of how to update and view prices
within a NEAR contract.

[example contract]: https://github.com/pyth-network/pyth-crosschain/tree/main/target_chains/near/example

A CLI-based approach can also be taken, see the [update.sh][] example
script in the repository to see how.

[update.sh]: https://github.com/pyth-network/pyth-crosschain/blob/main/target_chains/near/scripts/update.sh

## Contracts

Currently Pyth is only deployed on NEAR testnet and can be found at
the address: [`pyth.testnet`](https://testnet.nearblocks.io/address/pyth.testnet)
