# How Pyth Lazer works

Pyth Lazer is a permissioned service that provides ultra-low-latency market data to consumers.
It aggregates data from multiple publishers and distributes it to consumers through a multi-tier architecture.

## System Components

The architecture consists of four main services that work together to provide ultra-low-latency data to consumers.

### INSERT DIAGRAM HERE

### Publishers

Publishers are the entities that provide market data to Lazer. They submit price updates via authenticated WebSocket connections.
Each publisher is configured with specific permissions defining which feeds they can update.

### Relayers

The Relayer is the ingestion layer that receives and validates all incoming updates from publishers.

**Key responsibilities:**

- **Authentication**: Validates publisher access tokens and optional Ed25519 signatures.
- **Rate limiting**: Enforces configurable limits of price updates per publisher.
- **Message forwarding**: Publishes validated updates to NATS or Kafka.
- **History Service**: Maintains a connection to the History Service to cache historical data for circuit breaker validation.

The Relayer also maintains a connection to the History Service to cache historical data for circuit breaker validation.

### Aggregator Component

The Aggregator is a library component embedded within both the Router and History Service.
It consumes publisher updates from the message bus and computes aggregated price feeds.

**Aggregation logic:**
The Aggregator computes median prices, confidence intervals (using interquartile range), and best bid/ask prices from multiple publisher inputs.
It filters out stale data and ensures minimum publisher requirements are met before publishing aggregated updates.

### Router Service

The Router is the real-time distribution layer that serves price feeds to consumers.

**Key features:**

- **WebSocket streaming**: Provides `/v1/stream` endpoint for real-time price updates
- **HTTP REST API**: Offers `/v1/latest_price` for on-demand price queries
- **Channel types**: Supports real-time and fixed-rate channels (1ms, 50ms, 200ms)
- **Multi-chain support**: Generates on-chain payloads for Solana, EVM, and other chains

### Message Transport Layer

The system supports dual message queue backends for flexibility. This allows the system to be deployed in a multi-datacenter environment.

- **NATS Jetstream**: Provides pub/sub messaging with stream persistence.
- **Apache Kafka**: Can be used instead of NATS for message transport.
