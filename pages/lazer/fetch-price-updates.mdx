import { Callout, Steps } from "nextra/components";

# How to Fetch Price Updates from Pyth Lazer

Pyth Lazer provides a [websocket API (TODO: Prod)](https://pyth-lazer-staging.dourolabs.app/docs) to fetch price updates.

This guide explains how to **fetch** price updates, explore various **properties** of these updates, and configure the channel for **update frequency**. (TODO: Rewrite maybe)

Fetching price updates is a three-step process:

1. **Acquire** an access token.
2. **Adjust** subscription parameters.
3. **Subscribe** to the price updates via websocket API.

The websocket server is available at `wss://pyth-lazer-staging.dourolabs.app/v1/stream`.
TODO: Add the prod URL.

<Steps>

### 1. Acquire an access token

Please fill out [this form](https://tally.so/r/nP2lG5) to contact the Pyth team and get the access token.

Use the access token to authenticate the websocket connection as a `Bearer {token}{:bash}`.

### 2. Adjust subscription parameters

One can configure the request/subscription parameters to customize the received price updates. A sample request is shown below:

```json
  client.send({
    type: "subscribe",
    subscriptionId: 1,
    priceFeedIds: [1, 2],
    properties: ["price"],
    chains: ["solana"],
    channel: "fixed_rate@200ms",
  });
```

Here:

- `subscriptionId` is an arbitrary numeric identifier one can choose for a subscription. It will eb returned back in response by the server. It doesn not affect the signed payload.
- `priceFeedIds` is the list of price feeds one like to receive. Data for all price feeds will be present in the signed price updates generated. Refer to the [Price Feed IDs list](./price-feeds.mdx) for the supported price feeds.
- `properties` is the list of properties one can request, such as **price**, **bestBidPrice**, **bestAskPrice**, etc. TODO: Find more properties.
- `chains` is the list of chains for which one need a signed payload, such as **evm**, **solana**, etc.
- `channel` allows to configure the update rate: updates in the **real_time** channel are sent as frequently as possible, while **fixed_rate@200ms** and **fixed_rate@50ms** channels are updated at fixed rates.

There are also a few other parameters one may use. Refer to the [API documentation](https://pyth-lazer-staging.dourolabs.app/docs) for more details.

### 3. Subscribe to the price updates

To subscribe to the price updates, one needs to send the request to the websocket server. The server will respond with a signed price update.

1. Pyth Lazer provides a [SDK](https://github.com/pyth-network/pyth-crosschain/tree/main/lazer/sdk/js) to seamlessly integrate the websocket API into your application.
   It can be installed using the following command:

```bash
npm install --save @pythnetwork/pyth-lazer-sdk
```

2. Then create a [`PythLazerClient`](https://github.com/pyth-network/pyth-crosschain/blob/main/lazer/sdk/js/src/client.ts#L32) object using the URL and the access token requested from the Pyth team in the first step.

```js
import { PythLazerClient } from "@pythnetwork/pyth-lazer-sdk";

const client = new PythLazerClient(
  "wss://pyth-lazer-staging.dourolabs.app/v1/stream",
  "ctoken1"
);
```

3. After the client is created, one can adjust the subscription parameters and subscribe to the price updates.

```js
client.ws.addEventListener("open", () => {
  client.send({
    type: "subscribe",
    subscriptionId: 1,
    priceFeedIds: [1, 2],
    properties: ["price"],
    chains: ["solana"],
    channel: "fixed_rate@200ms",
  });
});
```

4. One the connection is established, the server will start sending the price updates to the client.

```js
client.addMessageListener((message) => {
  console.log(message);
});
```

By default, price updates contain the `parsed` field that one can use to easily interpret the update in their backend or frontend, as well as evm and/or solana fields that contain data that one should include in the on-chain transaction:

```json
{
  "type": "streamUpdated",
  "subscriptionId": 1,
  "parsed": {
    "timestampUs": "1730986152400000",
    "priceFeeds": [
      {
        "priceFeedId": 1,
        "price": "1006900000000"
      },
      {
        "priceFeedId": 2,
        "price": "2006900000000"
      }
    ]
  },
  "solana": {
    "encoding": "hex",
    "data": "b9011a82d239c094c52016990d6ca2b261dbb1157ad503cbd3ea0679493316150cf3457624d19ec3f6e0a0e94373ab0971e39d939beda15cc02eb3c5454eb700f1f7310df65210bee4fcf5b1cee1e537fabcfd95010297653b94af04d454fc473e94834f2a0075d3c7938094b99e52260600030201000000010000b5ea6fea00000002000000010000c58f44d3010000"
  }
}
```

</Steps>
